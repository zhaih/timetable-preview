<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Choose Courses</title>
        <script src="/static/js/jquery.min.js"></script>
        <link rel="stylesheet" href="/static/css/style.css" charset="utf-8">
        <script type="text/javascript">
            var courseList
            var choosedCourse = new Object()
            $(document).ready(()=>{
                // get courses titles and fill it to the table
                fetchCourses(()=>{
                    $('#tableBody').empty()
                    courseList.forEach(item=>{
                        var tr = document.createElement('tr')
                        var titleTd = document.createElement('td')
                        var checkTd = document.createElement('td')
                        var checkBox = document.createElement('input')
                        $(titleTd).html(item)
                        $(checkBox)
                            .attr('type','checkbox')
                            .attr('name','course')
                            .attr('value',item)
                            .click(function(){
                                choosedCourse[$(this).attr('value')] =
                                    $(this).is(":checked")
                            })
                        $(checkTd).append(checkBox)
                        $(tr).append(titleTd).append(checkTd)
                        $('#tableBody').append(tr)
                    })
                })
                // bind the button to redirect to timetable
                $("#toTimetable").click(function(){
                    var form = document.createElement('form')
                    var item = document.createElement('input')
                    $(item)
                        .attr('name','courses')
                        .attr('value',getChoosedCourses())
                    $(form)
                        .attr('method','post')
                        .attr('action','/timetable')
                        .css('display','none')
                        .append(item)
                    $('body').append(form)
                    $(form).submit()
                })
            })
            // get all choosed courses and transfer it to JSON string
            function getChoosedCourses(){
                var res = new Array()
                for (var key in choosedCourse){
                    if (choosedCourse[key]){
                        res.push(key)
                    }
                }
                return JSON.stringify(res)
            }
            // get all the course titles
            function fetchCourses(callback){
                $.get('/getCourseTitles',(data,status)=>{
                    if (status != 'success'){
                        console.log('GET /getCourseTitles failed');
                    }
                        courseList = data
                        if (callback != undefined){
                            callback()
                        }
                })
            }
        </script>
    </head>
    <body>
        <table>
            <thead>
                <tr>
                    <td>
                        Course title
                    </td>
                    <td>
                        Select
                    </td>
                </tr>
            </thead>
            <tbody id="tableBody">

            </tbody>
        </table>
        <!-- Here is for adding courses that not included -->
        <p>
            If your timetable not inclueded, use following to query
        </p>
        <input type="input" id="url" value="" placeholder="Timetable url">
        <button type="button" id="query">Query!</button>
        <button type="button" id="toTimetable">
            <!-- <a href="/timetable">View Timetable!</a> -->
        </button>
    </body>
</html>
